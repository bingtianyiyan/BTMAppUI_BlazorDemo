@page "/"
@page "/Products/Products"

@using DAL
@using DAL.Contracts;
@using DAL.Models

@inject IProductService productService
@inject NavigationManager NavigationManager
@code {
	private Task<AuthenticationState> authenticationState { get; set; }
	private List<Product> products;
	private string searchKeyword;
	public string SearchReturnMessage { get; set; }
	private string SearchKeyword { get; set; }
	protected override async Task OnInitializedAsync()
	{
		products = await productService.GetProducts();
	}

	protected async Task SearchProducts(string keyword)
	{
		SearchReturnMessage = string.Empty;
		products = await productService.SearchProducts(keyword);
		if (!products.Any())
			SearchReturnMessage = "No results found.";
	}

	public void Enter(KeyboardEventArgs e)
	{
		if (e.Code == "Enter" || e.Code == "NumpadEnter")
		{
			return;
		}
	}

	protected void ProductDetails(int product_Id)
	{
		NavigationManager.NavigateTo("/Products/ProductDetails/" + product_Id);
	}
}

@if (products is null)
{
	<p><em>Loading...</em></p>
}
else
{
	<section class="py-5 text-center container">
		<div class="col-lg-8 mx-auto">
			<EditForm Model="@products" OnSubmit="() => SearchProducts(searchKeyword)" style="margin:auto;max-width:300px" class="searchProduct">
				<input type="text" placeholder="Search.." name="search" @bind-value="@searchKeyword">
				<button type="button" @onclick="() => SearchProducts(searchKeyword)"><i class="fa fa-search"></i></button>
			</EditForm>
		</div>
	</section>
	<!-- CAROUSEL START-->
	<section class="py-5 text-center container">
		<div class="col-lg-8 mx-auto">
			<div class="img-wrap">
				<img class="img-fluid" src="https://cb.scene7.com/is/image/Crate/cb_dPLP_20230209_OutdoorDinnerwareV2?wid=1440&qlt=85&op_sharpen=1">
			</div>
		</div>
	</section>
	<!-- CAROUSEL END-->
	<div class="row">
		@foreach (var product in products)
		{

			<!--cards-->
			<div class="col-md-3">
				<figure class="card card-product rounded-0 border-0" style="height: 500px;">
					<div class="col-md-12 img-fluid">

						<img class="img-fluid" @onclick="() => ProductDetails(product.Product_Id)" src="https://cb.scene7.com/is/image/Crate/FauxBoisMelDinnerPltSSS21/$web_pdp_main_carousel_med$/201215170032/faux-bois-melamine-dinner-plate.jpg">
						@*<img [src]="product?.images[0]?.convertedProductImage || '../../assets/default-image.png'" class="img-fluid" />*@
					</div>
					<div class="bottom-wrap text-center mt-3">
						<span class="small">New Arrival</span>
						<h5 class="title">@product.Product_Name</h5>
						<div class="price-wrap h6">
							<span class="price-new">@Math.Round((decimal)product.Price, 2)</span> <br>
							<del class="text-muted"> $1980</del>
						</div> <!-- price-wrap.// -->
					</div> <!-- bottom-wrap.// -->
				</figure>
			</div>
		}
	</div>
}



